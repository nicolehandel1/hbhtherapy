mailster=function(e,t,n,r){"use strict";var o=t(".status");e.events.push("documentReady",i);e.events.push("documentReady",function(){t.fn.sortable&&t(".export-order").sortable({connectWith:".export-order",_placeholder:"ui-state-highlight",containment:".export-order-wrap",receive:function(e,t){t.item.find("input").prop("checked",t.item.closest(".export-order").is(".selected"))}}).on("change","input",function(){var e=t(this);e.parent().appendTo(e.is(":checked")?t(".export-order.selected"):t(".export-order.unselected"))})});e.$.document.on("change","#export-subscribers input,#export-subscribers select",i).on("click",".export-order-add",function(){t(".export-order.unselected").find("li").appendTo(".export-order.selected").find("input").prop("checked",true);return false}).on("click",".export-order-remove",function(){t(".export-order.selected").find("li").appendTo(".export-order.unselected").find("input").prop("checked",false);return false}).on("change",'select[name="outputformat"]',function(){t("#csv-separator")[t(this).val()=="csv"?"show":"hide"]()}).on("submit","#export-subscribers",function(){var r=t(this).serialize();e.util.ajax("export_contacts",{data:r},function(i){if(i.success){n.onbeforeunload=function(){return e.l10n.manage.onbeforeunloadexport};var s=t(".performance").val();o.addClass("progress");a(0,s,i.data.count,r)}else{alert(i.data.msg)}},function(e,t,n){alert(t)});return false});function a(t,i,s,l){var c=(new Date).getTime(),u=Math.min(1,i*t/s)*100;o.html(e.util.sprintf(e.l10n.manage.prepare_download,s,""));e.util.ajax("do_export",{limit:i,offset:t,data:l},function(c){var d=u>=100&&c.data.finished;if(c.success){if(!d)a(t+1,i,s,l);o.html(e.util.sprintf(e.l10n.manage.prepare_download,s,Math.ceil(u)+"%"));if(d){n.onbeforeunload=null;o.html(e.l10n.manage.export_finished);o.html(e.util.sprintf(e.l10n.manage.downloading,s));if(c.data.filename){setTimeout(function(){o.removeClass("progress");r.location=c.data.filename},2e3)}}else{o.html(e.util.sprintf(e.l10n.manage.write_file,c.data.total,Math.ceil(u)+"%"))}}else{n.onbeforeunload=null;o.html(e.l10n.manage.error_export);alert(c.data.msg)}},function(e,t,n){})}function i(){setTimeout(function(){var n=t("#export-subscribers").serialize();t("#export-subscriber-button").prop("disabled",true);e.util.ajax("get_subscriber_count",{data:n},function(n){if(n.success){t("#export-subscriber-button").val(e.util.sprintf(e.l10n.manage.export_n_subscribers,n.data.count_formated)).prop("disabled",!n.data.count)}})},10)}return e}(mailster||{},jQuery,window,document);