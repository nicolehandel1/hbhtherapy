mailster=function(e,t,a,n){"use strict";var s=t(".wp-filter"),i=t(".theme-browser"),l=s.find(".filter-links a"),d=s.find(".search-form"),o=s.find(".wp-filter-search"),r=s.find("#typeselector"),c,u,f="",m="",g=1,h=0,p=0,v=o.val(),C=r.val(),w=[],y=false,b=false;l.on("click",function(e){e.preventDefault();if(!y)j(t(this).data("sort"));return});d.on("submit",function(e){e.preventDefault();c&&clearTimeout(c);q()});o.on("keyup change",function(e){if(13==e.keyCode){return}c&&clearTimeout(c);c=setTimeout(q,1e3)});r.on("change",function(e){c&&clearTimeout(c);q()});i.on("click",".theme-screenshot, .more-details",function(){k.open(t(this).closest(".theme"))}).on("click",".update",function(e){e.preventDefault();t(this).addClass("updating-message");S(this.href,t(this).closest(".theme").data("slug"))}).on("click",".download",function(e){e.preventDefault();t(this).addClass("updating-message");R(this.href,t(this).closest(".theme").data("slug"))}).on("click",".install",function(e){e.preventDefault();t(this).addClass("updating-message");$(t(this).closest(".theme").data("slug"))}).on("click",".activate",function(e){e.preventDefault();t(this).addClass("updating-message");U(t(this).closest(".theme").data("slug"))}).on("click",".deactivate",function(e){e.preventDefault();t(this).addClass("updating-message");L(t(this).closest(".theme").data("slug"))}).on("click",".popup",function(){var n=this.href;if(!/^https?/.test(n))return true;var s=t(this).data(),i=a.screenLeft!=undefined?a.screenLeft:screen.left,l=a.screenTop!=undefined?a.screenTop:screen.top,d=e.$.window.width(),o=e.$.window.height(),r,c,u;if(/%/.test(s.width)){s.width=d*(parseInt(s.width,10)/100)}if(/%/.test(s.height)){s.height=o*(parseInt(s.height,10)/100)}r=d/2-s.width/2+i;c=o/2-s.height/2+l;u=a.open(n,"mailster_themebrowser","scrollbars=auto,resizable=1,menubar=0,toolbar=0,location=0,directories=0,status=0, width="+s.width+", height="+s.height+", top="+c+", left="+r);if(a.focus)u.focus();return false});t(".upload-addon").on("click",function(){t(".upload-field").toggle()});e.$.window.on("click",".upload-addon",function(){t(".upload-field").show()});e.events.push("documentReady",function(){e.$.window.on("scroll.mailster",e.util.throttle(_,500))});var k=function(){if(this===a)return new s;var s=t(".theme-overlay"),i=null,l=null,d=null,o=null,r=s.find(".right"),c=s.find(".left"),u=s.find(".close"),f=s.find(".default"),m=s.find(".campaign"),g=s.find(".delete-theme"),h={};var p=function(a){if("string"===typeof a){a=t('[data-slug="'+a+'"]')}if(!a||!a.length)return false;s.find(".theme-screenshots img").hide();s.find(".theme-screenshots iframe").hide();s.removeAttr("class");s.addClass("theme-overlay loading");i=a;h=a.data("item");s.find(".theme-name").html(h.name+'<span class="theme-version">'+(h.version?h.version:"")+"</span>");s.find(".theme-author").html(e.util.sprintf("By "+h.author));s.find(".theme-description").html(h.description);s.find(".theme-tags").html(h.tags&&h.tags.length?"<span>Tags:</span> "+h.tags.join(", "):"");if(h.src){s.find(".theme-screenshots iframe").show().attr("src",h.src+"?nocache="+ +new Date)}else{s.find(".theme-screenshots img").attr("src",h.image_full).attr("srcset",h.image_full+" 1x, "+h.image_fullx2+" 2x")}if(h.update_available)s.addClass("has-update");if(h.installed)s.addClass("is-installed");if(h.is_default)s.addClass("is-default");if(h.download)s.addClass("has-download");if(h.purchase_url)s.addClass("has-purchase");var n="";if(h.files){n+='<label>Template Files: <select class="theme-file-selector">';for(var o in h.files){if(h.files.hasOwnProperty(o))n+='<option value="'+o+'">'+h.files[o].label+" ("+o+")</option>"}n+="</select></label>"}s.find(".theme-files").html(n);l=i.prev();d=i.next();c.prop("disabled",!l.length)[!l.length?"addClass":"removeClass"]("disabled");r.prop("disabled",!d.length)[!d.length?"addClass":"removeClass"]("disabled");s.show();A("addon",h.slug);s.removeClass("loading")},v=function(){B("addon");s.hide()},C=function(){p(i.next())},w=function(){p(i.prev())},b=function(){var a=t(".theme-file-selector").val();if("index.html"==a&&confirm(e.util.sprintf(e.l10n.addons.confirm_delete,'"'+h.name+'"'))){I(h.slug);v()}else if(confirm(e.util.sprintf(e.l10n.addons.confirm_delete_file,'"'+a+'"','"'+h.name+'"'))){I(h.slug,a,function(){t(".theme-file-selector").val("index.html").trigger("change").find('option[value="'+a+'"]').remove()})}return false},k=function(){if(confirm(e.util.sprintf(e.l10n.addons.confirm_default,'"'+h.name+'"'))){var a=t('[data-slug="'+h.slug+'"]');y=true;e.util.ajax("default_addon",{slug:h.slug},function(e){if(e.success){j("installed",function(){t('[data-slug="'+h.slug+'"]').find(".notice-success").html("<p>"+e.data.msg+"</p>")});a.find(".notice-error").empty()}else{a.find(".notice-error").html("<p>"+e.data.msg+"</p>")}a.removeClass("loading").find(".updating-message").removeClass("updating-message");y=false;v()},function(e,t,a){})}return false},x=function(){n.location=this.href+"&addon="+h.slug+"&file="+s.find(".theme-file-selector").val();return false},_=function(){s.find(".theme-screenshots iframe").attr("src",h.files[t(this).val()].src)},D=function(){r.on("click",C);c.on("click",w);u.on("click",v);g.on("click",b);f.on("click",k);m.on("click",x);s.on("change",".theme-file-selector",_);s.find(".theme-screenshots iframe").on("load",function(){s.removeClass("loading")});s.find(".theme-screenshots img").on("load",function(){t(this).show()})};D();return{open:p,close:v,next:C,prev:w,delete:b}}();function x(){o.val(z("search"));r.val(z("type")||"term");u=z("browse")||"all";if(z("search")){q()}else{j(u);k.open(z("addon"))}}function _(){var t=e.util.top()+e.$.window.height();if(!y&&t>Math.round(n.documentElement.scrollHeight*.9)&&h>p){g++;F()}}function j(e,a){u&&t("body").removeClass("browse-"+u)&&l.filter('[data-sort="'+u+'"]').removeClass("current");u=e||false;B("addon");if(u){T();l.filter('[data-sort="'+u+'"]').addClass("current");A("browse",u);t("body").addClass("browse-"+u);F(a)}}function D(){u&&t("body").removeClass("browse-"+u)&&l.filter('[data-sort="'+u+'"]').removeClass("current");B("browse");B("addon");u=false;g=1;w=[]}function T(){B("search");B("type");m="";f="";o.val("");r.val("term");g=1;w=[]}function q(){v=e.util.trim(o.val());v=v.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");C=r.val();if(v&&(f!=v||m!=C)){m=C;f=v;D();F();A("search",v);A("type",C)}return}function $(a){var n=t('[data-slug="'+a+'"]');y=true;n.addClass("loading");n.find(".notice-warning").addClass("updating-message").html("<p>"+e.l10n.addons.installing+"</p>");e.util.ajax("quick_install",{plugin:a,step:"install"},function(t){if(t.success){n.addClass("is-installed").find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.addons.installed+"</p>");n.find(".notice-error").empty()}else{n.find(".notice-error").html("<p>"+t.data.msg+"</p>")}n.removeClass("loading").find(".updating-message").removeClass("updating-message");y=false},function(e,t,a){})}function R(a,n){var s=t('[data-slug="'+n+'"]');console.log(s);y=true;s.addClass("loading").find(".request-download").addClass("updating-message");s.find(".notice-warning").addClass("updating-message").html("<p>"+e.l10n.addons.installing+"</p>");return;e.util.ajax("quick_install",{url:a,slug:n},function(t){if(t.success){s.addClass("is-installed").find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.addons.installed+"</p>");s.find(".notice-error").empty()}else{s.find(".notice-error").html("<p>"+t.data.msg+"</p>")}s.removeClass("loading").find(".updating-message").removeClass("updating-message");y=false},function(e,t,a){})}function U(a){var n=t('[data-slug="'+a+'"]');y=true;n.addClass("loading");n.find(".notice-warning").addClass("updating-message").html("<p>"+e.l10n.addons.activating+"</p>");e.util.ajax("quick_install",{plugin:a,step:"activate"},function(t){if(t.success){n.addClass("active").find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.addons.activated+"</p>");n.find(".notice-error").empty()}else{n.find(".notice-error").html("<p>"+t.data.msg+"</p>")}n.removeClass("loading").find(".updating-message").removeClass("updating-message");y=false},function(e,t,a){})}function L(a){var n=t('[data-slug="'+a+'"]');y=true;n.addClass("loading");n.find(".notice-warning").addClass("updating-message").html("<p>"+e.l10n.addons.deactivating+"</p>");e.util.ajax("quick_install",{plugin:a,step:"deactivate"},function(t){if(t.success){n.removeClass("active").find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.addons.deactivated+"</p>");n.find(".notice-error").empty()}else{n.find(".notice-error").html("<p>"+t.data.msg+"</p>")}n.removeClass("loading").find(".updating-message").removeClass("updating-message");y=false},function(e,t,a){})}function S(a,n){var s=t('[data-slug="'+n+'"]');y=true;s.addClass("loading").find(".request-download").addClass("updating-message");s.find(".notice-warning").addClass("updating-message").html("<p>"+e.l10n.addons.updating+"</p>");e.util.ajax("download_addon",{url:a,slug:n},function(a){if(a.success){s.find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.addons.updated+"</p>");s.find(".notice-error").empty();var n=t("#menu-posts-newsletter").find(".current").find(".update-plugins");if(n){if(n.text()>1){n.find(".update-count").text(n.text()-1)}else{n.remove()}}}else{s.find(".notice-error").html("<p>"+a.data.msg+"</p>")}s.removeClass("loading").find(".updating-message").removeClass("updating-message");y=false},function(e,t,a){})}function I(a,n,s){var i=t('[data-slug="'+a+'"]');y=true;i.addClass("loading");e.util.ajax("delete_addon",{slug:a,file:n||null},function(e){if(s){i.removeClass("loading");s()}else{i.animate({opacity:0},function(){i.animate({width:0,"margin-right":0},function(){i.remove();y=false})})}},function(e,t,a){})}function P(e,a){var n=t('[data-slug="'+e+'"]');n.find(".notice-error").html("<p>"+t("<div>"+a+"</div>").text()+"</p>")}function F(a){if(g==1){t("body").removeClass("no-results");t("body").addClass("loading-content");i.html("");w=[]}y=true;e.util.ajax("query_addons",{search:o.val(),type:r.val(),browse:z("browse"),page:g},function(e){if(g==1){t("body").removeClass("loading-content");t(".theme-count").html(e.data.total);h=e.data.total}w.concat(e.data.addons);i.append(e.data.html);p=t(".theme").length;if(e.data.error){alert(e.data.error);t("body").addClass("no-results")}else if(!p){t("body").addClass("no-results")}y=false;a&&a()},function(e,t,a){})}function z(e){var t=new URLSearchParams(a.location.search);return t.get(e)}function A(e,t){var n=new URLSearchParams(a.location.search);n.set(e,t);a.history.pushState({},"",decodeURIComponent(a.location.pathname+"?"+n))}function B(e){var t=new URLSearchParams(a.location.search);t.delete(e);a.history.pushState({},"",decodeURIComponent(a.location.pathname+"?"+t))}x();e.addons=e.addons||{};e.addons.install=$;e.addons.installFromUrl=R;e.addons.delete=I;e.addons.error=P;return e}(mailster||{},jQuery,window,document);