mailster=function(a,e,t,i){"use strict";var n=e(i.body).hasClass("mobile"),s=e(i.body).hasClass("index-php"),r=e(".mailster-mb-subscribers"),l=e("#mailster-subscriber-range"),o=e("#subscriber-chart-wrap"),d=e("#subscriber-chart"),c,u,f={responsive:false,legend:false,animationEasing:"easeOutExpo",maintainAspectRatio:false,tooltips:{backgroundColor:"rgba(56,56,56,0.9)",displayColors:false,cornerRadius:2,caretSize:8,callbacks:{label:function(e,t){return a.util.sprintf(a.l10n.dashboard.subscribers,k(e.yLabel))}}},scales:{xAxes:[{ticks:{maxTicksLimit:20},_type:"time",_time:{format:"MM/DD/YYYY HH:mm",round:"day",tooltipFormat:"ll HH:mm"}}],yAxes:[{ticks:{callback:function(a){return v(a,true)}}}]}};if(d.length){u=d[0].getContext("2d")}l.on("change",function(){b()}).trigger("change");!s&&t.postboxes.add_postbox_toggles("newsletter_page_mailster_dashboard");e(i).on("verified.mailster",function(a,t,i,n){e(".mailster-purchasecode").html(t);e(".mailster-username").html(i);e(".mailster-email").html(n);e("#mailster-mb-mailster").addClass("verified");e("#mailster-register-panel").delay(2500).fadeTo(400,0,function(){e("#mailster-register-panel").slideUp(400)})}).on("click",".locked",function(){e(".purchasecode").focus().select()}).on("click",".enable-auto-update",function(){var t=e(this);t.html(a.l10n.dashboard.checking);e.get(this.href,function(){t.remove()});return false}).on("click",".check-for-update",function(){var t=e(this);t.html(a.l10n.dashboard.checking);a.util.ajax("check_for_update",function(i){t.html(a.l10n.dashboard.check_again);if(i.success){t.closest(".postbox")[i.data.update?"addClass":"removeClass"]("has-update");e(".update-version").html(i.data.version);e(".update-last-check").html(i.data.last_update)}});return false}).one("click",".load-language",function(){var t=e(this);t.html(a.l10n.dashboard.downloading);a.util.ajax("load_language",function(e){if(e.success){t.html(a.l10n.dashboard.reload_page)}});return false}).on("click",".reset-license",function(){if(!confirm(a.l10n.dashboard.reset_license)){return false}});var h=function(t){if(!t){return}var n,s=e(".mailster-mb-"+t),r=s.find(".mailster-mb-select"),l=s.find(".mailster-mb-label"),o=s.find(".mailster-mb-link"),d=o.attr("href");if(!r.length){return}r.on("change",function(){c(e(this).val())}).trigger("change");e(i).on("heartbeat-tick",function(a,e){if(n){c(n,true)}});s.find(".piechart").easyPieChart({animate:1e3,rotate:180,barColor:a.colors.main,trackColor:a.colors.track,lineWidth:9,size:75,lineCap:"butt",onStep:function(a){this.$el.find("span").text(Math.round(a))},onStop:function(a){this.$el.find("span").text(Math.round(a))}});function c(e,i){if(!i){s.addClass("mailster-loading")}a.util.ajax("get_dashboard_data",{type:t,id:e},function(a){var e=a.data.data;o.html(e.name).removeAttr("class").addClass("mailster-mb-link").attr("href",d.replace("%d",e.ID));if(e.status){o.addClass("status-"+e.status)}s.find(".stats-total").html(e.sent_formatted);s.find(".stats-open").data("easyPieChart").update(e.openrate*100);s.find(".stats-clicks").data("easyPieChart").update(e.clickrate*100);s.find(".stats-unsubscribes").data("easyPieChart").update(e.unsubscriberate*100);s.find(".stats-bounces").data("easyPieChart").update(e.bouncerate*100);n=e.ID;s.removeClass("mailster-loading")})}};var m=new h("campaigns");var p=new h("lists");function b(e,t,i,n){r.addClass("mailster-loading");a.util.ajax("get_dashboard_chart",{range:l.val()},function(a){g();r.removeClass("mailster-loading");if(!c){c=new Chart(u,{type:"line",data:a.data.chart,options:f})}})}function g(){c=null;if(d){d.remove()}d=e("<canvas>").prependTo(o);u=d[0].getContext("2d");d.attr({width:o.width(),height:o.height()})}function v(a,e){if(a>=1e6){return(a/1e3).toFixed(1)+"M"}else if(a>=1e3&&!e){return(a/1e3).toFixed(1)+"K"}return!(a%1)?k(a):""}function k(a,e,t,i){a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var n=!isFinite(+a)?0:+a;var s=!isFinite(+e)?0:Math.abs(e);var r=typeof i==="undefined"?",":i;var l=typeof t==="undefined"?".":t;var o="";var d=function(a,e){var t=Math.pow(10,e);return""+(Math.round(a*t)/t).toFixed(e)};o=(s?d(n,s):""+Math.round(n)).split(".");if(o[0].length>3){o[0]=o[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,r)}if((o[1]||"").length<s){o[1]=o[1]||"";o[1]+=new Array(s-o[1].length+1).join("0")}return o.join(l)}return a}(mailster||{},jQuery,window,document);