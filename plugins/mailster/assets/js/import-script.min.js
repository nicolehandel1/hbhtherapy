mailster=function(e,t,a,n){"use strict";var i,r=t(".uploadinfo"),o=t(".status"),s,l,d=false,p=false,u={},c=0,f=0,m={};e.$.document.on("submit",".importer-form",function(){var a=t(this);var n=a.serialize();var i=a.data("type");o=a.find(".status");a.prop("readonly",true).addClass("loading");o.addClass("progress spinner").html(e.l10n.manage.prepare_import);e.util.ajax("import_handler",{type:i,data:n},function(e){if(e.success){if(e.data.html){a.html(e.data.html)}if(e.data.identifier){l=e.data.identifier;b()}}else{o.html(e.data.msg).removeClass("spinner")}a.prop("readonly",false).css("opacity",1).removeClass("loading")},function(){a.prop("readonly",false).css("opacity",1).removeClass("loading")});return false}).on("submit",".importer-quickinstall-form",function(){var e=t(this);var a=e.serialize();var n=e.data("slug");var i=e.data("id");e.prop("readonly",true).addClass("loading");w(i,n,"install");return false}).on("change",".column-selector",function(){if("_new"==t(this).val()){var a=prompt(e.l10n.manage.define_custom_field,t(this).data("for")||e.l10n.manage.my_custom_field);if(!a)return false;var n=y(a);t(this).val(n)}}).on("click","#addlist",function(){var a=t("#new_list_name").val();if(!a){return false}t(e.util.sprintf('<li><label><input name="_lists[]" value="%s" type="checkbox" checked> %s </label></li>',a,a)).appendTo("#section-lists > ul");t("#new_list_name").val("");return false}).on("change","#signup",function(){t("#signupdate").prop("disabled",!t(this).is(":checked"))}).on("change",".wordpress-user-roles .list-toggle",function(){t(".no-role-cb").prop("checked",false)}).on("change","ul.roles input",function(){t(".no-role-cb").prop("checked",false)}).on("change",".no-role-cb",function(){t(this).parent().parent().parent().parent().find("ul.roles input").add(".wordpress-user-roles .list-toggle").prop("checked",false)}).on("click",".do-import",function(){var n=t("#subscriber-table").serialize();if(!/%5D=email/.test(n)){alert(e.l10n.manage.select_emailcolumn);return false}if(!t('input[name="status"]:checked').length){alert(e.l10n.manage.select_status);return false}if(!confirm(e.l10n.manage.confirm_import))return false;var i=t(this).prop("disabled",true),r=t('input[name="status"]:checked').val(),o=t("#import-ajax-loading").css({display:"inline-block"}),l=t("#identifier").val(),d=t("#performance").is(":checked");s=new Date;t(".import-process-wrap").show();u={identifier:l,data:n,status:r,performance:d,customfields:m};h();t(this).prop("disabled",false);a.onbeforeunload=function(){return e.l10n.manage.onbeforeunloadimport};return false}).on("click",".pause-import",function(){t(".import-process").addClass("paused");d=true;return false}).on("click",".resume-import",function(){t(".import-process").removeClass("paused");d=false;h();return false}).on("click",".cancel-import",function(){if(!confirm(e.l10n.manage.cancel_import))return false;p=true;if(d){d=false;h()}return false});typeof wpUploaderInit=="object"&&e.events.push("documentReady",function(){i=new plupload.Uploader(wpUploaderInit);i.bind("Init",function(e){var a=t("#plupload-upload-ui");if(e.features.dragdrop&&!t(n.body).hasClass("mobile")){a.addClass("drag-drop");t("#drag-drop-area").bind("dragover.wp-uploader",function(){a.addClass("drag-over")}).bind("dragleave.wp-uploader, drop.wp-uploader",function(){a.removeClass("drag-over")})}else{a.removeClass("drag-drop");t("#drag-drop-area").unbind(".wp-uploader")}if(e.runtime=="html4"){t(".upload-flash-bypass").hide()}});i.bind("FilesAdded",function(e,a){t("#media-upload-error").html("");t("#wordpress-users").fadeOut();setTimeout(function(){e.refresh();e.start()},1)});i.bind("BeforeUpload",function(e,t){r.html("uploading")});i.bind("UploadFile",function(e,t){});i.bind("UploadProgress",function(t,a){r.html(e.util.sprintf(e.l10n.manage.uploading,a.percent+"%"))});i.bind("Error",function(e,t){r.html(t.message);e.refresh()});i.bind("FileUploaded",function(e,t,a){a=JSON.parse(a.response);if(a.success){l=a.data.identifier}else{r.html(a.data.message);e.refresh()}});i.bind("UploadComplete",function(t,a){if(l){r.html(e.l10n.manage.prepare_data);b()}});i.init()});function h(){var n=f,i,r,o,s,l,m=t(".import-process").find(".bar"),b=t(".import-percentage"),w=(new Date).getTime();if(d){return false}if(!c){_(0,0,0,0,0);m.width(0)}e.util.ajax("do_import",{id:c,options:u,canceled:p},function(e){if(e.success){n=e.data.p_total*100;l=e.data.p_total>=1||e.data.canceled;i=n-f;r=f;f=n;_(e.data.f_imported,e.data.f_errors,e.data.f_total,n,e.data.memoryusage);m.stop(true,true).animate({width:n+"%"},{duration:(new Date).getTime()-w,easing:"linear",progress:function(e,t){o=Math.floor(r+i*t);if(o!=s){b.html(o+"%");s=o}},complete:function(){if(l){a.onbeforeunload=null;t(".import-result").html(e.data.html);v();t(".import-process-wrap").hide()}}});if(!l){++c;h()}}else{g(e.data.msg)}},function(e,t,a){g(t)})}function g(e){o.removeClass("progress spinner").html(e)}function v(e){a.scroll({top:e||125,left:0,behavior:"smooth"})}function b(){e.util.ajax("get_import_data",{identifier:l},function(a){if(a.success){v();t(".import-result").eq(0).html(a.data.html).show();t(".import-wrap").hide();t("input.datepicker").datepicker({dateFormat:"yy-mm-dd",showAnim:"fadeIn",onClose:function(){}});t.fn.select2&&t(".tags-input").select2({placeholder:e.l10n.manage.choose_tags,tags:true,theme:"mailster"});o=t(".import-process").find(".import-status")}})}function _(a,n,i,r,o){var l=(new Date).getTime()-s.getTime(),d=Math.ceil((100-r)*(l/r)/1e3);var p=new Date(d*1e3),u=p.getHours()-1,c=p.getMinutes(),f=p.getSeconds(),m=(d>=3600?(u<10?"0"+u:u)+":":"")+((c<10?"0"+c:c)+":")+(f<10?"0"+f:f);a&&t(".import-imported").html(e.util.sprintf(e.l10n.manage.import_imported,a,i));n&&t(".import-errors").html(e.util.sprintf(e.l10n.manage.import_errors,n));a&&t(".import-memory").html(o);a&&t(".import-time").html(m)}function w(a,n,i,r){var o=t("#manage-import-"+a).find(".manage-import-body");e.util.ajax("quick_install",{plugin:n,step:i,context:r},function(e){if(e.success){if(e.data.next){w(a,n,e.data.next,["import_method",a])}else if(e.data.content){o.html(e.data.content)}}else{}},function(e,t,a){})}function y(a){var n=e.util.sanitizeTag(a);t("#subscriber-table").find(".custom-fields-select").each(function(){t('<option value="'+n+'">'+a+"</option>").appendTo(t(this))});m[n]=a;return n}return e}(mailster||{},jQuery,window,document);