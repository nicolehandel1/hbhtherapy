mailster=function(e,t,a,n){"use strict";var i=t(".wp-filter"),s=t(".theme-browser"),l=i.find(".filter-links a"),o=i.find(".search-form"),r=i.find(".wp-filter-search"),d=i.find("#typeselector"),f,c,u="",m="",p=1,h=0,g=0,v=r.val(),w=d.val(),C=[],b=false,y=false;l.on("click",function(e){e.preventDefault();if(!b)U(t(this).data("sort"));return});o.on("submit",function(e){e.preventDefault();f&&clearTimeout(f);D()});r.on("keyup change",function(e){if(13==e.keyCode){return}f&&clearTimeout(f);f=setTimeout(D,1e3)});d.on("change",function(e){f&&clearTimeout(f);D()});s.on("click",".theme-screenshot, .more-details",function(){x.open(t(this).closest(".theme"))}).on("click",".update",function(e){e.preventDefault();t(this).addClass("updating-message");L(this.href,t(this).closest(".theme").data("slug"))}).on("click",".download",function(e){e.preventDefault();t(this).addClass("updating-message");I(this.href,t(this).closest(".theme").data("slug"))}).on("click",".popup",function(){var n=this.href;if(!/^https?/.test(n))return true;var i=t(this).data(),s=a.screenLeft!=undefined?a.screenLeft:screen.left,l=a.screenTop!=undefined?a.screenTop:screen.top,o=e.$.window.width(),r=e.$.window.height(),d,f,c;if(/%/.test(i.width)){i.width=o*(parseInt(i.width,10)/100)}if(/%/.test(i.height)){i.height=r*(parseInt(i.height,10)/100)}d=o/2-i.width/2+s;f=r/2-i.height/2+l;c=a.open(n,"mailster_themebrowser","scrollbars=auto,resizable=1,menubar=0,toolbar=0,location=0,directories=0,status=0, width="+i.width+", height="+i.height+", top="+f+", left="+d);if(a.focus)c.focus();return false});t(".upload-template").on("click",function(){t(".upload-field").toggle()});e.$.window.on("click",".upload-template",function(){t(".upload-field").show()});e.events.push("documentReady",function(){q();e.$.window.on("scroll.mailster",e.util.throttle(k,500))});e.events.push("windowLoad",function(){t("body").off("mousedown")});var x=function(){if(this===a)return new i;var i=t(".theme-overlay"),s=null,l=null,o=null,r=null,d=i.find(".right"),f=i.find(".left"),c=i.find(".close"),u=i.find(".default"),m=i.find(".campaign"),p=i.find(".edit"),h=i.find(".save"),g=i.find(".delete-theme"),v,w=i.find(".codeeditor textarea"),C={};var y=function(a){if("string"===typeof a){a=t('[data-slug="'+a+'"]')}if(!a||!a.length)return false;i.addClass("loading");i.find(".theme-screenshots img").hide();i.find(".theme-screenshots iframe").hide();i.removeAttr("class");i.addClass("theme-overlay loading");s=a;C=a.data("item");i.find(".theme-name").html(C.name+'<span class="theme-version">'+(C.version?C.version:"")+"</span>");i.find(".theme-author").html(e.util.sprintf("By "+C.author));i.find(".theme-description").html(C.description);i.find(".theme-tags").html(C.tags&&C.tags.length?"<span>Tags:</span> "+C.tags.join(", "):"");if(C.src){i.find(".theme-screenshots iframe").show().attr("src",C.src+"?nocache="+ +new Date)}else{i.find(".theme-screenshots img").attr("src",C.image_full).attr("srcset",C.image_full+" 1x, "+C.image_fullx2+" 2x")}if(C.update_available)i.addClass("has-update");if(C.installed)i.addClass("is-installed");if(C.is_default)i.addClass("is-default");if(C.download)i.addClass("has-download");if(C.purchase_url)i.addClass("has-purchase");var n="";if(C.files){n+='<label>Template Files: <select class="theme-file-selector">';for(var r in C.files){if(C.files.hasOwnProperty(r))n+='<option value="'+r+'">'+C.files[r].label+" ("+r+")</option>"}n+="</select></label>"}i.find(".theme-files").html(n);l=s.prev();o=s.next();f.prop("disabled",!l.length)[!l.length?"addClass":"removeClass"]("disabled");d.prop("disabled",!o.length)[!o.length?"addClass":"removeClass"]("disabled");i.show();E("template",C.slug)},x=function(){M("template");i.hide()},_=function(){y(s.next())},k=function(){y(s.prev())},T=function(){var a=t(".theme-file-selector").val();if("index.html"==a&&confirm(e.util.sprintf(e.l10n.templates.confirm_delete,'"'+C.name+'"'))){R(C.slug);x()}else if(confirm(e.util.sprintf(e.l10n.templates.confirm_delete_file,'"'+a+'"','"'+C.name+'"'))){R(C.slug,a,function(){t(".theme-file-selector").val("index.html").trigger("change").find('option[value="'+a+'"]').remove()})}return false},j=function(){if(confirm(e.util.sprintf(e.l10n.templates.confirm_default,'"'+C.name+'"'))){var a=t('[data-slug="'+C.slug+'"]');b=true;e.util.ajax("default_template",{slug:C.slug},function(e){if(e.success){U("installed",function(){t('[data-slug="'+C.slug+'"]').find(".notice-success").html("<p>"+e.data.msg+"</p>")});a.find(".notice-error").empty()}else{a.find(".notice-error").html("<p>"+e.data.msg+"</p>")}a.removeClass("loading").find(".updating-message").removeClass("updating-message");b=false;x()},function(e,t,a){})}return false},D=function(){n.location=this.href+"&template="+C.slug+"&file="+i.find(".theme-file-selector").val();return false},$=function(){e.util.ajax("load_template_file",{template:C.slug,file:i.find(".theme-file-selector").val()},function(n){i.addClass("is-editor");i.find(".codeeditor h3").html(e.util.sprintf(e.l10n.templates.editing,i.find(".theme-file-selector").val(),'"'+C.name+'"'));t(".CodeMirror").remove();w.val(n.data.html);if(wp.codeEditor){v=wp.codeEditor.initialize(w,{codemirror:e.util.codemirrorargs})}else{v={codemirror:a.CodeMirror.fromTextArea(w.get(0),e.util.codemirrorargs)}}},function(e,t,a){});return false},I=function(){e.util.ajax("set_template_html",{content:v.codemirror.getValue(),slug:C.slug,file:i.find(".theme-file-selector").val()},function(e){i.removeClass("is-editor");t(".CodeMirror").remove();w.val("");i.find(".theme-screenshots iframe").attr("src",i.find(".theme-screenshots iframe").attr("src"))},function(e,t,a){});return false},L=function(){i.addClass("loading");i.find(".theme-screenshots iframe").attr("src",C.files[t(this).val()].src);if(i.is(".is-editor")){$()}},S=function(){d.on("click",_);f.on("click",k);c.on("click",x);g.on("click",T);u.on("click",j);m.on("click",D);p.on("click",$);h.on("click",I);i.on("change",".theme-file-selector",L);i.on("click",".theme-description a",function(e){e.preventDefault();a.open(this.href);return false});i.find(".theme-screenshots iframe").on("load",function(){i.removeClass("loading")});i.find(".theme-screenshots img").on("load",function(){t(this).show()})};S();return{open:y,close:x,next:_,prev:k,delete:T}}();function _(){r.val(P("search"));d.val(P("type")||"term");c=P("browse")||"installed";if(P("search")){D()}else{U(c);x.open(P("template"))}}function k(){var t=e.util.top()+e.$.window.height();if(!b&&t>Math.round(n.documentElement.scrollHeight*.9)&&h>g){p++;F()}}function U(e,a){c&&t("body").removeClass("browse-"+c)&&l.filter('[data-sort="'+c+'"]').removeClass("current");c=e||false;M("template");if(c){j();l.filter('[data-sort="'+c+'"]').addClass("current");E("browse",c);t("body").addClass("browse-"+c);F(a)}}function T(){c&&t("body").removeClass("browse-"+c)&&l.filter('[data-sort="'+c+'"]').removeClass("current");M("browse");M("template");c=false;p=1;C=[]}function j(){M("search");M("type");m="";u="";r.val("");d.val("term");p=1;C=[]}function D(){v=e.util.trim(r.val());v=v.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");w=d.val();if(v&&(u!=v||m!=w)){m=w;u=v;T();F();E("search",v);E("type",w)}return}function $(a){var n=t('[data-slug="'+a+'"]');b=true;n.addClass("loading");n.find(".notice-warning").addClass("updating-message").html("<p>Updating...</p>");e.util.ajax("download_template",{slug:a},function(e){b=false},function(e,t,a){})}function I(a,n){var i=t('[data-slug="'+n+'"]');b=true;i.addClass("loading").find(".request-download").addClass("updating-message");i.find(".notice-warning").addClass("updating-message").html("<p>"+e.l10n.templates.downloading+"</p>");e.util.ajax("download_template",{url:a,slug:n},function(t){if(t.success){i.addClass("is-installed").find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.templates.downloaded+"</p>");i.find(".notice-error").empty()}else{i.find(".notice-error").html("<p>"+t.data.msg+"</p>")}i.removeClass("loading").find(".updating-message").removeClass("updating-message");b=false},function(e,t,a){})}function L(a,n){var i=t('[data-slug="'+n+'"]');b=true;i.addClass("loading").find(".request-download").addClass("updating-message");i.find(".notice-warning").addClass("updating-message").html("<p>"+e.l10n.templates.updating+"</p>");e.util.ajax("download_template",{url:a,slug:n},function(a){if(a.success){i.find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.templates.updated+"</p>");i.find(".notice-error").empty();var n=t("#menu-posts-newsletter").find(".current").find(".update-plugins");if(n){if(n.text()>1){n.find(".update-count").text(n.text()-1)}else{n.remove()}}}else{i.find(".notice-error").html("<p>"+a.data.msg+"</p>")}i.removeClass("loading").find(".updating-message").removeClass("updating-message");b=false},function(e,t,a){})}function R(a,n,i){var s=t('[data-slug="'+a+'"]');b=true;s.addClass("loading");e.util.ajax("delete_template",{slug:a,file:n||null},function(e){if(i){s.removeClass("loading");i()}else{s.animate({opacity:0},function(){s.animate({width:0,"margin-right":0},function(){s.remove();b=false})})}},function(e,t,a){})}function S(e,a){var n=t('[data-slug="'+e+'"]');n.find(".notice-error").html("<p>"+t("<div>"+a+"</div>").text()+"</p>")}function F(a){if(p==1){t("body").removeClass("no-results");t("body").addClass("loading-content");s.html("");C=[]}b=true;e.util.ajax("query_templates",{search:r.val(),type:d.val(),browse:P("browse"),page:p},function(e){if(p==1){t("body").removeClass("loading-content");t(".theme-count").html(e.data.total);h=e.data.total}C.concat(e.data.templates);s.append(e.data.html);g=t(".theme").length;if(e.data.error){alert(e.data.error);t("body").addClass("no-results")}else if(!g){t("body").addClass("no-results")}b=false;a&&a()},function(e,t,a){})}function P(e){var t=new URLSearchParams(a.location.search);return t.get(e)}function E(e,t){var n=new URLSearchParams(a.location.search);n.set(e,t);a.history.pushState({},"",decodeURIComponent(a.location.pathname+"?"+n))}function M(e){var t=new URLSearchParams(a.location.search);t.delete(e);a.history.pushState({},"",decodeURIComponent(a.location.pathname+"?"+t))}function q(){var a=new plupload.Uploader(wpUploaderInit),n=t(".uploadinfo");a.bind("Init",function(a){var n=t("#plupload-upload-ui");if(a.features.dragdrop&&!e.util.isTouchDevice){n.addClass("drag-drop");t("#drag-drop-area").bind("dragover.wp-uploader",function(){n.addClass("drag-over")}).bind("dragleave.wp-uploader, drop.wp-uploader",function(){n.removeClass("drag-over")})}else{n.removeClass("drag-drop");t("#drag-drop-area").unbind(".wp-uploader")}if(a.runtime=="html4")t(".upload-flash-bypass").hide()});a.init();a.bind("FilesAdded",function(e,t){setTimeout(function(){e.refresh();e.start()},1)});a.bind("BeforeUpload",function(e,t){});a.bind("UploadFile",function(e,t){});a.bind("UploadProgress",function(t,a){n.html(e.util.sprintf(e.l10n.templates.uploading,a.percent+"%"))});a.bind("Error",function(e,t){n.html(t.message);e.refresh()});a.bind("FileUploaded",function(e,t,a){a=JSON.parse(a.response);if(a.success){location.reload()}else{n.html(a.data.error)}});a.bind("UploadComplete",function(e,t){})}_();e.templates=e.templates||{};e.templates.download=$;e.templates.downloadFromUrl=I;e.templates.delete=R;e.templates.error=S;return e}(mailster||{},jQuery,window,document);